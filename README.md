# Track-My-Run webapp

A Flask based, [HTMX](https://htmx.org/) powered web application used for tracking and managing personal aerobic runs. 

The live version of this site can be found on [www.track-my-run.com](www.track-my-run.com)

## Table of Contents

- [Purpose](#purpose)
- [Local Installation](#local-installation)
- [Migrations and Tests](#migrations-and-tests)
- [Future Improvements](#future-improvements)
- [Contributing](#contributing)

## Purpose

The primary purpose of this project is to get hands on experience with development and production-level deployment of a full-fledged modern-day web application, using a common web framework (Flask) and an interesting non-SPA front end JS libary (HTMX).

This application has all the common components of a web-application including:
  - Dockerfile with flask server for containerized local development
  - docker-compose file with 2 postgres services (one for dev and one for testing) and a Redis service
  - Initial automated unit tests (some functional and some that connect to the test DB)
  - SQLAlchemy ORM models and a migrations folder for generating new migrations based on schema updates (using the Alembic migration tool)
  - Common authentication/user registration patterns using salts, and session management with cookies and Redis
  - Jinja templates that generate HTMX code (allowing the server to avoid returning JSON, only HTML/X)
  - Github Actions config files for automated unit test execution on GitHub, as well as single click deployment to your deployment server (EC2 in my case)
  - Configurations for production deployment (in the form of `gunicorn` and production config templates)

## Local Installation
Installation of the application for local experimentation and development requires some prerequisites:
- Python installed (I am using `3.12.3` as of this writing)
- Docker service up and running
- `docker-compose` command working

First, clone and `cd` the repository
```
git clone https://github.com/alexbudy/tmr.git
cd tmr
```
Take a look at the `.env.template` file - check/modify those values to your liking (the defaults should be ok for development) and then rename that file to `.env`. This is to prevent `.env` files to be committed as they can contain sensitive information.

Then, build and run the docker containers

```
docker-compose build
docker-compose up
```
Server should come up and you can access the server on `localhost:5000` (or `SERVER_PORT` value).
As long as your `FLASK_APP` environment variable is not `prod`, server/template code changes will be hot-reloaded on change and save.

## Migrations and Tests
Migration files are auto-generated by `Alembic` (more on that below).
To generate new migrations and run the unit test suite, you will need to create a virtual environment and install dependencies:
```
python -m venv venv
source venv/Scripts/activate (or source venv/bin/activate on unix machines)
pip install -r requirements.txt
```

#### Unit Tests

After activating your virtual environment, you can run
```
python -m pytest
```
from the root directory, which will discover and run all tests in the repo.

#### Migrations
You can make changes to the schema by modifying or creating new models in `app/models/models.py`

Then, create a new migration file with alembic:
```
alembic revision --autogenerate -m "Briefly describe changes here"
```
The file will be  be placed in `migrations/version`, prepended by a unique hash value.
Now the migrations need to be applied to the DB(s) - run
```
alembic --name dev upgrade head   # this applies to the dev DB
alembic --name test upgrade head  # this is for the test DB
```
There is also `--name prod` for the prod DB (and in fact configurations for the DBs can be made in `alembic.ini`).
Here are some other useful commands (picked from [this blog post](https://medium.com/@johnidouglasmarangon/using-migrations-in-python-sqlalchemy-with-alembic-docker-solution-bd79b219d6a#useful-commands:~:text=database%20were%20printed.-,Useful%20commands,-In%20this%20section)).
```
alembic upgrade head                            # apply all migrations
alembic downgrade base                          # revert all migrations
alembic downgrade -1                            # revert migration one by one
alembic upgrade +1                              # apply migration one by one
alembic downgrade base && alembic upgrade head  # reset the db
```
## Future Improvements
Now that the framework for the application is in place, there can be many potential directions to take the application to work with new technologies and implement interesting features.
- A friend-based system where you can track/compare your runs with friends, send friend requests, and messages
- Implementation of [Cooper Aerobics](https://www.cooperaerobics.com/Downloads/About/Aerobics-Points-System.aspx) point based system for tracking aerobic points, with targets, goals, and automated notifications.
- a global weekly, monthly, and distance based leaderboard
- Profile/admin pages
- Addition of a JSON API to allow for SPA JS frameworks

The possibilities become endless!

## Contributions
The primary purpose of this project as it stands is for educational purposes. All contributions, suggestions, etc are welcome!

Feel free to contact the owner (me) at alexbudy@gmail.com.

Thanks for reading!